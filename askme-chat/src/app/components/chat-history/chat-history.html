<div class="chat-history-container h-full flex flex-col" [class.collapsed]="collapsed">
  <div class="p-4 border-b ml-[-4px]">
    <div class="w-full flex justify-start items-center">
      <!-- [matTooltip]="collapsed ? 'Expand' : 'Close'"  -->
      <button
        mat-icon-button
        (click)="collapsed ? onToggleCollapse() : onToggleCollapse()"
        class="mt-[-10px]"
      >
        <mat-icon>{{ collapsed ? 'chevron_left' : 'chevron_right' }}</mat-icon>
      </button>
      @if (!collapsed) {
      <h2 class="text-lg font-semibold mb-3">Chat History</h2>
      }
    </div>
    @if (!collapsed) {
    <button
      mat-stroked-button
      color="primary"
      (click)="onNewChat()"
      [class]="collapsed ? 'w-12 h-12 p-0 min-w-0' : 'w-full mb-2'"
      [matTooltip]="collapsed ? 'New Chat' : ''"
    >
      <mat-icon>add</mat-icon>

      <span class="ml-2">New Chat</span>
    </button>

    <button mat-stroked-button (click)="onClearAllSessions()" class="w-full text-sm">
      Clear All History
    </button>
    }@else {
    <button
      mat-icon-button
      class=""
      (click)="onNewChat()"
      [matTooltip]="collapsed ? 'New Chat' : ''"
    >
      <mat-icon>add</mat-icon>
    </button>
    }
  </div>

  <div class="flex-1 overflow-y-auto">
    @if (sessions().length === 0) {
    <div class="p-4 text-center text-gray-500" [class.hidden]="collapsed">
      <mat-icon class="text-4xl mb-2">chat_bubble_outline</mat-icon>
      <p>No saved chats yet</p>
      <p class="text-sm">Start a conversation to save chat history</p>
    </div>
    @if (collapsed) {
    <div class="p-2 text-center text-gray-500">
      <mat-icon class="text-2xl">chat_bubble_outline</mat-icon>
    </div>
    } } @else {
    <mat-nav-list>
      @for (session of sessions(); track session.id) {
      <mat-list-item
        class="session-item cursor-pointer hover:bg-gray-50"
        (click)="onSessionClick(session.id)"
        [matTooltip]="collapsed ? session.name : ''"
      >
        @if (collapsed) {
        <!-- Collapsed view: icon only -->
        <div class="w-full flex justify-center items-center py-2">
          <mat-icon class="text-gray-600">chat</mat-icon>
        </div>
        } @else {
        <!-- Expanded view: full content -->
        <div class="w-full">
          <div class="flex justify-between items-start">
            <div class="flex-1 min-w-0">
              <h4 class="font-medium text-sm truncate mb-1">
                {{ session.name }}
              </h4>
              <p class="text-xs text-gray-500 mb-1">
                {{ truncateMessage(session.lastMessage) }}
              </p>
              <p class="text-xs text-gray-400">
                {{ formatDate(session.updatedAt) }} â€¢ {{ session.messageCount }} messages
              </p>
            </div>

            <button
              mat-icon-button
              [matMenuTriggerFor]="sessionMenu"
              (click)="$event.stopPropagation()"
              class="ml-2"
            >
              <mat-icon class="text-gray-400">more_vert</mat-icon>
            </button>

            <mat-menu #sessionMenu="matMenu">
              <button mat-menu-item (click)="onRenameSession(session, $event)">
                <mat-icon>edit</mat-icon>
                <span>Rename</span>
              </button>
              <button mat-menu-item (click)="onDeleteSession(session, $event)" class="text-red-600">
                <mat-icon>delete</mat-icon>
                <span>Delete</span>
              </button>
            </mat-menu>
          </div>
        </div>
        }
      </mat-list-item>
      }
    </mat-nav-list>
    }
  </div>
</div>
